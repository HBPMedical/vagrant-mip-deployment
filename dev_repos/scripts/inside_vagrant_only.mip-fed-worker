#!/usr/bin/env bash

TAG=""
BRANCH=""
COMMIT=""

POSITIONAL=()
while [[ $# -gt 0 ]]; do
	case $1 in
		--tag)
			TAG="$2"
			shift
			shift
			;;
		--branch)
			BRANCH="$2"
			shift
			shift
			;;
		--commit)
			COMMIT="$2"
			shift
			shift
			;;
		*)
			POSITIONAL+=("$1")
			shift
			;;
	esac
done
set -- "${POSITIONAL[@]}"

ret=1
export DEBIAN_FRONTEND=noninteractive

ret=0
if [[ $ret -eq 0 ]]; then
	if [[ "$TAG" != "" || "$BRANCH" != "" || "$COMMIT" != "" ]]; then
		echo "/vagrant/dev_repos/mip-deployment/mip --node-type wk --quiet --yes --keep-installer --force-install-unstable --version \"$TAG\" --branch \"$BRANCH\" --commit \"$COMMIT\" install"
		/vagrant/dev_repos/mip-deployment/mip --node-type wk --quiet --yes --keep-installer --force-install-unstable --version "$TAG" --branch "$BRANCH" --commit "$COMMIT" install
	else
		echo "/vagrant/dev_repos/mip-deployment/mip --node-type wk --quiet --yes --keep-installer install"
		/vagrant/dev_repos/mip-deployment/mip --node-type wk --quiet --yes --keep-installer install
	fi
	ret=$?
fi

if [[ $ret -eq 0 ]]; then
	echo "/vagrant/dev_repos/mip-deployment/mip --node-type wk --quiet --yes configure all"
	/vagrant/dev_repos/mip-deployment/mip --node-type wk --quiet --yes configure all
	ret=$?
fi

exit $ret
